{#
 # Homepage template
 # ---------------
 #
 # When this template gets loaded, it will be because someone has accessed
 # http://yoursite.com/ (without any URI). Craft checks to see if you have
 # a Single section set to be the Homepage (as you do, by default), and
 # loads the section’s Template (this file). A special ‘entry’ variable
 # will already be set for you, assigned to the Homepage entry.
 #
 # It's worth noting that even if you didn't have a Homepage Single section,
 # as long as this template remains at craft/templates/index.html, it
 # would still be the one to get loaded when accessing http://yoursite.com/,
 # albeit without an ‘entry’ variable already set for you.
 #
 # See this page for more details on how Craft routes requests:
 # http://craftcms.com/docs/routing
 #}

{% extends "_layouts/site" %}

{% set title = entry.title %}
{% set description = entry.description %}
{% set image = entry.image.first() %}


{% block styles %}
  {{ parent() }}

  <link rel="stylesheet" type="text/css" href="{{ craft.request.path }}/index.css" data-turbolinks-track="reload">
{% endblock %}

{% block main %}
  <article class="content page">

    {% include '_includes/article/hero' with { sub: 'share' } %}

    <div class="content-style">
      <div class="section-search form-group full">
        <input class="form-input" type="search" name="js-search" id="js-search" placeholder="Filter the blogs..." autocomplete="off" required>
        <svg class="form-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
        </svg>
        <span class="form-highlight"></span>
        <p class="form-hint">Enter a country, language, year or name in the field above to filter the blogs.</p>
      </div>

      {% cache %}

        {# Get the categories related to my "blogs" entries in structure order. #}
        {% set blogs = craft.entries.section('blogs').limit(null) %}
        {% set colleges = craft.categories.relatedTo(blogs) %}

        {# Loop the colleges. #}
        {% for college in colleges %}

        <section class="section js-college">
          <h1 id="{{ college.title | lower | url_encode }}" class="section-title">{{ college.title }}</h1>

          <p class="section-body">

          {# Get and loop through blogs related to this college. #}
          {% set allBlogsInCollege = craft.entries.relatedTo(college).order('blogYear desc') | group('blogYear') %}
          {% for year, allBlogsInYear in allBlogsInCollege %}
          <span class="js-list" id="{{ college }}-{{ year }}">
            <span class="section-year js-year">{{ year }}</span>
            <span class="list js-years">

            {% for blog in allBlogsInYear %}
              <span data-year="{{ blog.blogYear }}" class="section-blog">
                <span class="name"><a href="{{ blog.blogUrl }}" target="_blank" rel="noopener noreferrer" class="link">{{ blog.blogFirstName }}</a></span> | <span class="country">{% for country in blog.blogCountries %}{{ country.title }}{% if not loop.last %}, {% endif %}{% endfor %}</span>
                {% if blog.blogCountries.total() and blog.blogLanguages.total() %} - {% endif %}<span class="language">{% for language in blog.blogLanguages %}{{ language.title }}{% if not loop.last %}, {% endif %}{% endfor %}</span>
              </span>
            {% endfor %}

            </span>
          </span>
          {% endfor %}

          </p>
        </section>
        {% endfor %}

      {% endcache %}

      {% include('_includes/snippets/share.html') %}
    </div>
  </article>

{% endblock %}
