{#
 # Homepage template
 # ---------------
 #
 # When this template gets loaded, it will be because someone has accessed
 # http://yoursite.com/ (without any URI). Craft checks to see if you have
 # a Single section set to be the Homepage (as you do, by default), and
 # loads the section’s Template (this file). A special ‘entry’ variable
 # will already be set for you, assigned to the Homepage entry.
 #
 # It's worth noting that even if you didn't have a Homepage Single section,
 # as long as this template remains at craft/templates/index.html, it
 # would still be the one to get loaded when accessing http://yoursite.com/,
 # albeit without an ‘entry’ variable already set for you.
 #
 # See this page for more details on how Craft routes requests:
 # http://craftcms.com/docs/routing
 #}


{% extends "_layouts/site" %}


{% import '_includes/elements' as elements %}
{% import '_includes/helpers' as helpers %}


{% set title = entry.title %}
{% set description = entry.description %}


{% block scripts %}
  {{ parent() }}

  {# List #}
  <script>
    loadjs(['{{ siteUrl ~ 'assets/js/list.min.js' }}'], 'list');
    loadjs.ready('list', {
      success: function() {
        // SMOOTHSCROLL //
        const searchInput = document.getElementById('js-search');

        searchInput.addEventListener('focus', function () {
          smoothScroll.animateScroll(searchInput);
        });

        // LISTJS //
        const searchOptions = {
          valueNames: [
            'name',
            'country',
            'language',
            {
              data: ['year'],
            },
          ],
        };

        const lists = document.getElementsByClassName('js-list');
        const colleges = document.getElementsByClassName('js-college');
        const years = document.getElementsByClassName('js-years');

        let data = [];
        let blogs = 0;

        for (var i = 0; i < lists.length; ++i) {
          var listId = lists[i].id;

          data[i] = new List(listId, searchOptions);
          blogs += data[i].items.length;
        }

        console.log(blogs + ' blogs and counting. Woohoo! Add yours: https://uwcblogs.com/submit/');
        console.log('For developers: found a bug or want to contribute? Visit the GitHub repo: https://github.com/uwc/uwcblogs.');

        function searchAll() {

          // Get search value.
          let searchValue = searchInput.value;

          // Search all lists.
          for (var i = 0; i < lists.length; ++i) {
            data[i].search(searchValue);
          }

          // Hide all year numbers without blogs.
          for (var j = 0; j < years.length; ++j) {
            if (years[j].hasChildNodes()) {
              years[j].parentNode.style.display = 'block';
            } else {
              years[j].parentNode.style.display = 'none';
            }
          }

          // Hide all college names with all years hidden.
          for (var k = 0; k < colleges.length; ++k) {
            let yearsInCollege = colleges[k].getElementsByClassName('js-list');
            let empty = 0;

            for (var m = 0; m < yearsInCollege.length; ++m) {
              if (yearsInCollege[m].style.display === 'none') {
                empty++;
              }
            }

            if (empty === yearsInCollege.length) {
              colleges[k].style.display = 'none';
            } else {
              colleges[k].style.display = 'block';
            }
          }
        }

        if (searchInput) {
          searchInput.addEventListener('keyup', searchAll);
        }
      }
    });
  </script>
{% endblock %}


{% block links %}
  {{ parent() }}

  <meta name="msvalidate.01" content="B9F4E5A6EB3F584936548E454FA92129" />
{% endblock %}


{% block body %}
  {% cache %}
  {% minify %}
  <article class="w100 cf">
      <header class="content-hero w3">
        <h1 class="ts-title">{{ helpers.striptags(description) }}</h1>

        <div class="mv3">
          {{ elements.share(title) }}
        </div>

      </header>


    <div class="content w3">
      <div class="search mv5 form-group">
        <input class="form-input" type="search" name="js-search" id="js-search" placeholder="Search to filter the blogs..." autocomplete="off" required>
        <svg class="form-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
        </svg>
        <span class="form-highlight"></span>
      </div>

      {# Get the categories related to my "blogs" entries in structure order. #}
      {% set blogs = craft.entries.section('blogs').limit(null) %}
      {% set colleges = craft.categories.relatedTo(blogs) %}

      {# Loop the colleges. #}
      {% for college in colleges %}
        <section class="college mv5 cf js-college">
          <h2 id="{{ college.title | lower | replace(' ', '-') }}" class="college-title ts-header1">{{ college.title }}</h1>
          <p class="college-body mv2 cr">

          {# Get and loop through blogs related to this college. #}
          {% set allBlogsInCollege = craft.entries.relatedTo(college).order('blogYear desc') | group('blogYear') %}
          {% for year, allBlogsInYear in allBlogsInCollege %}
          <span class="js-list" id="{{ college.title | lower | replace(' ', '-') }}-{{ year }}">
            <span class="college-year mt2 ts-header3 js-year">{{ year }}</span>
            <span class="list js-years">

            {% for blog in allBlogsInYear %}
              <span class="college-blog ma0 ts-body" data-year="{{ blog.blogYear }}">
                <a href="{{ blog.blogLink }}" target="_blank" rel="noopener noreferrer" class="link name">{{ blog.blogFirstName }}</a> | <span class="country">{% for country in blog.blogCountries %}{{ country.title }}{% if not loop.last %}, {% endif %}{% endfor %}</span>
                {% if blog.blogCountries.total() and blog.blogLanguages.total() %} - {% endif %}<span class="language">{% for language in blog.blogLanguages %}{{ language.title }}{% if not loop.last %}, {% endif %}{% endfor %}</span>
              </span>
            {% endfor %}

            </span>
          </span>
          {% endfor %}

          </p>
        </section>
      {% endfor %}

    </div>
    <div class="w2 mb5 fl-right">
      {{ elements.share(title) }}
    </div>
  </article>
  {% endminify %}
  {% endcache %}
{% endblock %}
